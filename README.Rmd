---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(hospitals)
```

# hospitals <img src='man/figures/logo.svg' align="right" height="139" />

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

This R data package contains one single dataset --- the eponymous `hospitals`
tibble --- comprising the current `r nrow(hospitals)` hospitals in the
Portuguese National Health Service.

For a description of each variable and data sources used to assemble this
dataset browse the documentation with `?hospitals`.

## Installation

You can install the current version of hospitals with:

``` r
# install.packages("remotes")
remotes::install_github("nhs-pt/hospitals")
```

## The `hospitals` dataset

The `hospital_id` variable is a surrogate identifier created by us that ought to
help researchers refer to hospitals in an unambiguous way. The idea is for these
identifiers to never change. So if an hospital disappears, or is merged with
another one, we will deprecate old identifiers and create new, accordingly.

```{r dataset}
library(hospitals)

# Hospital identifier and short name
hospitals[c(1, 6)] %>% print(n = Inf)
```

## Helper functions

### `normalise()`

The names of hospitals found in the wild can have subtle variations.
The `normalise()` function matches hospital names found elsewhere to the
hospitals included in the dataset `hospitals`.

For example, with `normalise` you can convert hospital names found elsewhere to
the names found in `hospitals$hospital_short_name`:

```{r map_wild_names}
normalise(c('Hospital do Alto Minho'))
```

Also `normalise` is aware of old hospital names, and can map to the new ones:

```{r map_old_names}
normalise(c('Hospital do Alto Ave'))
```

The method behind `normalise` for matching hospital names to their names in
`hospital_short_name` is based on an heuristic that uses a minimal set of
keywords to identify the hospital. So it is pretty tolerant to variations in the
name as long as one of the critical keywords is found in the name, e.g., to
identify the Hospital of Algarve as such only the keyword *Algarve* needs to be
present in the name:

```{r keywords}
normalise(c('Algarve', 'H Algarve', 'Hospital do Algarve'))
```

Also `normalise` should be lenient with typos associated with accented characters:

```{r accented_chars}
normalise('Hospital de São João')

# Without the tildes the mapping still works fine
normalise('Hospital de Sao Joao')
```

Instead of the `hospital_short_name` you may ask for the `hospital_full_name` or the `hospital_id`:

```{r short_name}

# 'hospital_short_name' is the default 
normalise('Matosinhos', return = 'hospital_short_name')

normalise('Matosinhos', return = 'hospital_full_name')

normalise('Matosinhos', return = 'hospital_id')
```

### `get_hospital_attribute()`

`get_hospital_attribute()` is a thin wrapper function allowing you to easily
retrieve hospital attributes from the dataset `hospitals`. You specify the
hospitals by indicating what type of key you are providing: `"hospital_id"`,
`"hospital_acronym"`, `"hospital_short_name"` or `"hospital_full_name"`. And
specify the column variable in `hospitals` with the `value` argument (default is
`"hospital_short_name"`).

```{r}
# By default you get the hospital short name
get_hospital_attribute('h0001')

# Same as above
get_hospital_attribute('h0001', value = 'hospital_short_name')

# Or get instead the full name
get_hospital_attribute('h0001', value = 'hospital_full_name')

# Map the hospital short name to its full name
get_hospital_attribute('IPO de Lisboa', key = 'hospital_short_name', value = 'hospital_full_name')
```
